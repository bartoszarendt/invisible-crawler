# Environment identity
APP_ENV=prod
CRAWL_PROFILE=broad

# Core services (bundled docker-compose defaults)
DATABASE_URL=postgresql://invisible:REPLACE_ME@postgres:5432/invisible
REDIS_URL=redis://redis:6379/0
POSTGRES_DB=invisible
POSTGRES_USER=invisible
POSTGRES_PASSWORD=REPLACE_ME
QUEUE_NAMESPACE=prod-v1
POSTGRES_HOST_PORT=15432
REDIS_HOST_PORT=16379

# External service mode (optional): point DATABASE_URL/REDIS_URL at host-managed or managed services.

# Crawl behavior
CRAWLER_USER_AGENT=InvisibleCrawler/0.1 (Production crawler; contact=ops@example.com)
# Set <=0 for no page cap
CRAWLER_MAX_PAGES=0
DISCOVERY_REFRESH_AFTER_DAYS=7
DOMAIN_STATS_FLUSH_INTERVAL_PAGES=100
IMAGE_MIN_WIDTH=256
IMAGE_MIN_HEIGHT=256
LOG_LEVEL=INFO

# Phase A: Domain tracking (enabled by default)
# ENABLE_DOMAIN_TRACKING=true  # Enable persistent domain tracking
# DOMAIN_CANONICALIZATION_STRIP_SUBDOMAINS=false  # Strip subdomains: blog.example.com -> example.com

# Phase B: Per-domain budget (enabled by default)
# ENABLE_PER_DOMAIN_BUDGET=true  # Enable per-domain page budgets
# MAX_PAGES_PER_RUN=100  # Max pages per domain per crawl run

# Phase C: Smart scheduling (must enable BOTH flags together)
# ENABLE_SMART_SCHEDULING=true  # Use domains table for crawl candidates
# ENABLE_CLAIM_PROTOCOL=true  # Enable claim/lease protocol (requires SMART_SCHEDULING)
# ENABLE_CONTINUOUS_MODE=true  # Keep worker alive when queue is empty
# ENABLE_PERSISTENT_DUPEFILTER=true  # Persist URL dedup state across restarts
# NOTE: Phase C requires both ENABLE_SMART_SCHEDULING and ENABLE_CLAIM_PROTOCOL together

# InvisibleID evolution (future)
# ENABLE_IMMUTABLE_ASSETS=true  # Use image_assets + image_observations tables

# Broad-crawl tuned overrides
SCRAPY_CONCURRENT_REQUESTS=64
SCRAPY_CONCURRENT_REQUESTS_PER_DOMAIN=4
SCRAPY_DOWNLOAD_DELAY=0.25
SCRAPY_RANDOMIZE_DOWNLOAD_DELAY=true
SCRAPY_AUTOTHROTTLE_ENABLED=true
SCRAPY_AUTOTHROTTLE_START_DELAY=0.25
SCRAPY_AUTOTHROTTLE_MAX_DELAY=15
SCRAPY_AUTOTHROTTLE_TARGET_CONCURRENCY=4.0
SCRAPY_DOWNLOAD_TIMEOUT=20
SCRAPY_RETRY_ENABLED=true
SCRAPY_RETRY_TIMES=2

# Optional/future object storage (reserved for Phase 3)
OBJECT_STORE_ENDPOINT=http://minio:9000
OBJECT_STORE_BUCKET=invisible-images
OBJECT_STORE_ACCESS_KEY=change-me
OBJECT_STORE_SECRET_KEY=change-me
OBJECT_STORE_REGION=us-east-1
OBJECT_STORE_SECURE=false
